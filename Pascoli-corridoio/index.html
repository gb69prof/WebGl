<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pascoli – Corridoio</title>
<style>
body{margin:0;overflow:hidden;background:#0b1020;}
canvas{display:block;}
#info{
position:fixed;
top:10px;
left:10px;
color:white;
font-family:sans-serif;
background:rgba(0,0,0,0.4);
padding:8px 12px;
border-radius:8px;
}
</style>
</head>
<body>
<div id="info">Click per attivare il mouse – WASD per muoverti</div>

<script type="module">
import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';

const scene=new THREE.Scene();
scene.background=new THREE.Color(0x0b1020);
scene.fog=new THREE.Fog(0x0b1020,10,80);

const camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,0.1,200);
camera.position.set(0,1.6,5);

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.outputColorSpace=THREE.SRGBColorSpace;
document.body.appendChild(renderer.domElement);

// Lights
scene.add(new THREE.HemisphereLight(0x7ab8ff,0x0b1020,0.4));
const dirLight=new THREE.DirectionalLight(0xffffff,0.8);
dirLight.position.set(5,10,5);
scene.add(dirLight);

// Corridor
const floor=new THREE.Mesh(
    new THREE.PlaneGeometry(6,60),
    new THREE.MeshStandardMaterial({color:0x1b2740,roughness:0.9})
);
floor.rotation.x=-Math.PI/2;
floor.position.z=-30;
scene.add(floor);

const wallMat=new THREE.MeshStandardMaterial({color:0x121a2c,roughness:0.95});
const wallLeft=new THREE.Mesh(new THREE.BoxGeometry(0.2,3,60),wallMat);
wallLeft.position.set(-3,1.5,-30);
scene.add(wallLeft);

const wallRight=new THREE.Mesh(new THREE.BoxGeometry(0.2,3,60),wallMat);
wallRight.position.set(3,1.5,-30);
scene.add(wallRight);

// Empty frames
for(let i=0;i<5;i++){
    const z=-10-i*10;
    const frame=new THREE.Mesh(
        new THREE.PlaneGeometry(1.6,1),
        new THREE.MeshStandardMaterial({color:0x0e1426})
    );
    frame.position.set(-2.9,1.6,z);
    frame.rotation.y=Math.PI/2;
    scene.add(frame);

    const frame2=frame.clone();
    frame2.position.x=2.9;
    frame2.rotation.y=-Math.PI/2;
    scene.add(frame2);
}

// Video setup
const video=document.createElement('video');
video.src="pascoli-bassaQ.mp4";
video.loop=true;
video.muted=true;
video.playsInline=true;
video.play();

const videoTexture=new THREE.VideoTexture(video);
videoTexture.colorSpace=THREE.SRGBColorSpace;

const videoMat=new THREE.MeshBasicMaterial({
    map:videoTexture,
    transparent:true,
    opacity:1
});

const videoPlane=new THREE.Mesh(new THREE.PlaneGeometry(1.6,2.2),videoMat);
scene.add(videoPlane);

const keys={};
window.addEventListener("keydown",e=>keys[e.code]=true);
window.addEventListener("keyup",e=>keys[e.code]=false);

let yaw=0,pitch=0;

renderer.domElement.addEventListener("click",()=>{
    renderer.domElement.requestPointerLock();
    video.play();
});

document.addEventListener("mousemove",e=>{
    if(document.pointerLockElement===renderer.domElement){
        yaw-=e.movementX*0.002;
        pitch-=e.movementY*0.002;
        pitch=Math.max(-1.2,Math.min(1.2,pitch));
    }
});

function animate(){
    requestAnimationFrame(animate);

    camera.rotation.y=yaw;
    camera.rotation.x=pitch;

    if(keys["KeyW"])camera.position.z-=0.1;
    if(keys["KeyS"])camera.position.z+=0.1;

    // Video always in front on corridor center line
    videoPlane.position.set(0,1.6,camera.position.z-2.3);
    videoPlane.lookAt(camera.position);

    renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>
</body>
</html>
